import{r as o,q as k,u as A,j as e}from"./index-DA6Na_pq.js";import{a as i}from"./baseURL-D-lPueBZ.js";import{C as F,a as M}from"./CCardBody-6Dx6aIub.js";import{C as B}from"./CCardHeader-DZP1FFa0.js";import{a as l}from"./CContainer-Pekuqi4V.js";import{C as H,a as P,b as p,c as w,d as q,e as g}from"./CTable-BEyfeaqn.js";import{C as z,a as L,b as U,c as _}from"./CModalHeader-ItFSIcCL.js";import{C as O}from"./CFormInput-Djvhovm-.js";import"./DefaultLayout-D05Jrs9N.js";import"./index.esm-BxhKCtHB.js";import"./CCloseButton-Dh6QjDBd.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-Byw6dZ_c.js";import"./CFormControlValidation-D2muq1_r.js";import"./CFormLabel-Dr99k2io.js";const ne=()=>{const[C,y]=o.useState([]),[c,u]=o.useState([]),[E,n]=o.useState(!1),[d,m]=o.useState({}),[h,x]=o.useState(null),{tableName:t}=k(),R=A(),j=new URLSearchParams(R.search),r=j.get("dbId");j.get("dbName"),o.useEffect(()=>{!r||!t||b()},[r,t]);const b=async()=>{try{const a=(await i.get(`/databases/${r}/tables/${t}/rows`)).data.rows||[];if(y(a),a.length>0){const f=new Set;a.forEach(I=>{Object.keys(I).forEach(N=>f.add(N))}),u(Array.from(f))}else u([])}catch(s){console.error("Failed to fetch table data:",s)}},$=async s=>{try{await i.delete(`/databases/${r}/tables/${t}/rows/${s}`),b()}catch(a){console.error("Error deleting row:",a)}},S=s=>{x(s.id),m(s),n(!0)},T=()=>{x(null),m({}),n(!0)},v=async()=>{try{if(h){const{database_id:s,...a}=d;await i.put(`/databases/${r}/tables/${t}/rows/${h}`,a)}else await i.post(`/databases/${r}/tables/${t}/rows`,d);n(!1),b()}catch(s){console.error("Error saving row:",s)}},D=c.filter(s=>s!=="id"&&s!=="database_id");return e.jsxs(e.Fragment,{children:[e.jsxs(F,{className:"mt-4",children:[e.jsxs(B,{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("strong",{children:[t," - Table Rows"]}),e.jsx(l,{onClick:T,children:"+ Add Row"})]}),e.jsx(M,{children:C.length>0?e.jsxs(H,{bordered:!0,hover:!0,responsive:!0,children:[e.jsx(P,{children:e.jsxs(p,{children:[c.map(s=>e.jsx(w,{children:s},s)),e.jsx(w,{children:"Actions"})]})}),e.jsx(q,{children:C.map(s=>e.jsxs(p,{children:[c.map(a=>e.jsx(g,{children:s[a]},a)),e.jsxs(g,{children:[e.jsx(l,{color:"warning",size:"sm",onClick:()=>S(s),children:"Edit"})," ",e.jsx(l,{color:"danger",size:"sm",onClick:()=>$(s.id),children:"Delete"})]})]},s.id))})]}):e.jsx("p",{children:'No data found. Use "+ Add Row" to insert a new entry.'})})]}),e.jsxs(z,{visible:E,onClose:()=>n(!1),children:[e.jsx(L,{children:h?"Edit Row":"Add Row"}),e.jsx(U,{children:D.map(s=>e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:s}),e.jsx(O,{value:d[s]||"",onChange:a=>m({...d,[s]:a.target.value})})]},s))}),e.jsxs(_,{children:[e.jsx(l,{onClick:v,children:"Save"}),e.jsx(l,{color:"secondary",onClick:()=>n(!1),children:"Cancel"})]})]})]})};export{ne as default};
