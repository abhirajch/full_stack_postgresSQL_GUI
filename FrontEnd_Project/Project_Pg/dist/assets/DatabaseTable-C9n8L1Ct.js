import{h as w,u as R,r as n,j as e}from"./index-DA6Na_pq.js";import{a as f}from"./baseURL-D-lPueBZ.js";import{a as c}from"./CContainer-Pekuqi4V.js";import{C as S,a as F}from"./CCardBody-6Dx6aIub.js";import{C as $}from"./CCardTitle-CEufTsdP.js";import{C as B,a as D,b as I,c as M}from"./CModalHeader-ItFSIcCL.js";import{C as H}from"./CForm-DD-bYS1P.js";import{C as b}from"./CFormInput-Djvhovm-.js";import{C as L}from"./CFormSelect-DzP5mJN4.js";import"./DefaultLayout-D05Jrs9N.js";import"./index.esm-BxhKCtHB.js";import"./CCloseButton-Dh6QjDBd.js";import"./cil-user-Dlmw-Gem.js";import"./CFormControlWrapper-Byw6dZ_c.js";import"./CFormControlValidation-D2muq1_r.js";import"./CFormLabel-Dr99k2io.js";const O=["VARCHAR(255)","INTEGER","TEXT","BOOLEAN"],se=()=>{const g=w(),{state:T}=R(),{db:l}=T||{},[v,i]=n.useState(!1),[o,h]=n.useState([]),[d,u]=n.useState([{}]),[m,p]=n.useState(""),[C,x]=n.useState([]);n.useEffect(()=>{if(!(l!=null&&l.id))return;(async()=>{try{const t=await f.get(`/databases/${l.id}/related-tables`);x(t.data.tables)}catch(t){console.error("Error fetching tables:",t),alert("Failed to fetch tables")}})()},[l]);const N=()=>{h([...o,{name:"",type:""}])},y=()=>{u([...d,{}])},j=(s,t,a)=>{const r=[...o];r[s][t]=a,h(r)},A=(s,t,a)=>{const r=[...d];r[s][t]=a,u(r)},E=async()=>{var s,t;if(!m||o.length===0||d.length===0){alert("Please provide table name, at least one column and one row.");return}try{const a=await f.post(`/databases/${l.id}/tables`,{tableName:m,columns:o,data:d});alert("Table created successfully"),i(!1),h([]),u([{}]),p(""),x([...C,m])}catch(a){console.error("Error creating table:",a),alert(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Failed to create table")}},k=s=>{g(`/table/${s}?dbId=${l.id}&dbName=${l.db_name}`)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{children:["Database: ",l==null?void 0:l.db_name]}),C.length===0?e.jsx(c,{color:"success",onClick:()=>i(!0),children:"+ Add Table"}):e.jsxs("div",{className:"mb-3",children:[e.jsx(c,{color:"success",onClick:()=>i(!0),children:"+ Add Table"}),e.jsx("h5",{children:"Tables in this Database:"}),C.map((s,t)=>e.jsx(S,{className:"mb-2",onClick:()=>k(s),style:{cursor:"pointer"},children:e.jsx(F,{children:e.jsxs($,{children:["ðŸ§¾",s]})})},t))]}),e.jsxs(B,{visible:v,onClose:()=>i(!1),children:[e.jsx(D,{children:"Add New Table"}),e.jsx(I,{children:e.jsxs(H,{children:[e.jsx(b,{label:"Table Name",value:m,onChange:s=>p(s.target.value),className:"mb-3"}),e.jsx("h5",{children:"Columns"}),o.map((s,t)=>e.jsxs("div",{className:"d-flex mb-2 gap-2",children:[e.jsx(b,{placeholder:"Column Name",value:s.name,onChange:a=>j(t,"name",a.target.value)}),e.jsxs(L,{value:s.type,onChange:a=>j(t,"type",a.target.value),children:[e.jsx("option",{children:"Select Type"}),O.map(a=>e.jsx("option",{value:a,children:a},a))]})]},t)),e.jsx(c,{color:"secondary",onClick:N,className:"mb-3",children:"+ Add Column"}),e.jsx("h5",{children:"Initial Data"}),d.map((s,t)=>e.jsx("div",{className:"mb-2",children:o.map(a=>e.jsx(b,{placeholder:a.name,className:"mb-1",value:s[a.name]||"",onChange:r=>A(t,a.name,r.target.value)},a.name))},t)),e.jsx(c,{color:"secondary",onClick:y,children:"+ Add Row"})]})}),e.jsxs(M,{children:[e.jsx(c,{color:"primary",onClick:E,children:"Create Table"}),e.jsx(c,{color:"danger",onClick:()=>i(!1),children:"Cancel"})]})]})]})};export{se as default};
